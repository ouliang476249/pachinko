<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>弹珠机概率统计器</title>
<style>
  *{margin:0;padding:0;box-sizing:border-box}
  body{font-family:Arial;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);padding:20px;color:#333}
  .container{max-width:800px;margin:0 auto;background:#fff;border-radius:20px;padding:30px;box-shadow:0 10px 30px rgba(0,0,0,.3)}
  h1{text-align:center;margin-bottom:20px;font-size:28px}
  .sect{margin-bottom:25px;text-align:center}
  .sect input,.sect select,.sect button{padding:8px 12px;font-size:16px;border:1px solid #ccc;border-radius:5px}
  .sect button{background:#4CAF50;color:#fff;cursor:pointer}
  .drop-position{display:flex;justify-content:center;gap:20px;margin-bottom:25px}
  .drop-position button{padding:12px 25px;font-size:18px;border:none;border-radius:10px;cursor:pointer;background:#e0e0e0;transition:.3s}
  .drop-position button.active{background:#2196F3;color:#fff;transform:scale(1.05)}
  .holes{display:grid;grid-template-columns:repeat(6,1fr);gap:12px;margin-bottom:25px}
  .hole{text-align:center;padding:12px;background:#f5f5f5;border:2px solid #ddd;border-radius:10px}
  .hole.clicked{background:#ffeb3b;border-color:#ffc107}
  .hole h3{margin-bottom:8px}
  .hole-btns{display:flex;justify-content:center;gap:10px;margin-bottom:8px}
  .hole-btns button{width:36px;height:36px;border:none;border-radius:50%;font-size:20px;color:#fff;cursor:pointer}
  .add{background:#4CAF50}.remove{background:#f44336}
  .count{font-size:22px;font-weight:bold;color:#2196F3}
  .chart-box{background:#f9f9f9;padding:20px;border-radius:10px}
  .chart-box h3{text-align:center;margin-bottom:15px}
  .chart{display:flex;align-items:flex-end;height:300px;gap:8px;padding:10px 0}
  .bar-wrap{flex:1;display:flex;flex-direction:column;align-items:center;height:100%}
  .bar{width:100%;background:linear-gradient(to top,#4CAF50,#8BC34A);border-radius:5px 5px 0 0;position:relative;min-height:5px}
  .bar-val{position:absolute;top:-30px;left:50%;transform:translateX(-50%);font-size:11px;font-weight:bold;text-align:center}
  .bar-label{margin-top:8px;font-size:13px}
  .stats{text-align:center;font-size:18px;color:#666;margin-bottom:15px}
  .clear-btn{display:block;margin:0 auto;padding:10px 25px;background:#ff5722;color:#fff;border:none;border-radius:5px;font-size:16px;cursor:pointer}
</style>
</head>
<body>
<div class="container">
  <h1>弹珠机概率统计器</h1>

  <!-- 2. 机器选择 / 自定义 -->
  <div class="sect">
    <input id="newMachine" placeholder="新机器名称"/>
    <button onclick="addMachine()">添加机器</button>
    <select id="machineList" onchange="changeMachine()"></select>
  </div>

  <!-- 3. 掉落侧切换 -->
  <div class="drop-position">
    <button id="left"   onclick="setSide('left')">左侧掉落</button>
    <button id="center" onclick="setSide('center')" class="active">中间掉落</button>
    <button id="right"  onclick="setSide('right')">右侧掉落</button>
  </div>

  <!-- 4. 12 洞口 +/-/次数 -->
  <div class="holes" id="holes"></div>

  <!-- 5. 柱状图 -->
  <div class="chart-box">
    <h3>概率统计图（百分比 + 次数）</h3>
    <div class="chart" id="chart"></div>
  </div>

  <!-- 统计文字 -->
  <div class="stats" id="stats">总次数：0 | 当前：中间</div>
  <button class="clear-btn" onclick="clearCurrentSide()">清空当前侧</button>
</div>

<script>
/* ========== 数据层 ========== */
const STORAGE_KEY = 'pinball_full_data';
let machines = {};          // 全部机器数据
let curMachine = 'default'; // 当前机器
let curSide    = 'center';  // 当前查看/录入侧

/* 初始化：读本地存储 */
function loadStorage() {
  const raw = localStorage.getItem(STORAGE_KEY);
  machines = raw ? JSON.parse(raw) : {default:genEmptySides()};
}
function saveStorage() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(machines));
}
function genEmptySides() {
  return {left:new Array(12).fill(0), center:new Array(12).fill(0), right:new Array(12).fill(0)};
}

/* ========== 机器管理 ========== */
function addMachine() {
  const name = document.getElementById('newMachine').value.trim();
  if(!name || machines[name]) return;
  machines[name] = genEmptySides();
  saveStorage();
  fillMachineList(name);
  document.getElementById('newMachine').value = '';
}
function changeMachine() {
  curMachine = document.getElementById('machineList').value;
  renderAll();
}

/* 填充下拉框 */
function fillMachineList(selectName) {
  const list = document.getElementById('machineList');
  list.innerHTML = '';
  Object.keys(machines).forEach(m => {
    const opt = document.createElement('option');
    opt.value = m; opt.textContent = m;
    if(m === selectName) opt.selected = true;
    list.appendChild(opt);
  });
}

/* ========== 侧切换 ========== */
function setSide(side) {
  curSide = side;
  document.querySelectorAll('.drop-position button').forEach(b => b.classList.remove('active'));
  document.getElementById(side).classList.add('active');
  renderAll();
}

/* ========== 计数 ========== */
function addCount(i)  { machines[curMachine][curSide][i]++; saveStorage(); renderAll(); }
function subCount(i)  { if(machines[curMachine][curSide][i]>0){machines[curMachine][curSide][i]--; saveStorage(); renderAll();} }

/* 清空当前侧 */
function clearCurrentSide() {
  if(confirm('清空当前侧全部数据？')){
    machines[curMachine][curSide] = new Array(12).fill(0);
    saveStorage();
    renderAll();
  }
}

/* ========== 渲染 ========== */
function renderAll() {
  renderHoles();
  renderChart();
  renderStats();
}
function renderHoles() {
  const box = document.getElementById('holes');
  box.innerHTML = '';
  const arr = machines[curMachine][curSide];
  arr.forEach((n,i) => {
    const d = document.createElement('div');
    d.className = 'hole' + (n ? ' clicked' : '');
    d.innerHTML = `
      <h3>洞口 ${i+1}</h3>
      <div class="hole-btns">
        <button class="add"    onclick="addCount(${i})">+</button>
        <button class="remove" onclick="subCount(${i})">−</button>
      </div>
      <div class="count">${n}</div>`;
    box.appendChild(d);
  });
}
function renderChart() {
  const chart = document.getElementById('chart');
  chart.innerHTML = '';
  const arr = machines[curMachine][curSide];
  const total = arr.reduce((a,b)=>a+b,0), max = Math.max(...arr,1);
  arr.forEach((n,i) => {
    const p = total ? (n/total*100).toFixed(1) : 0;
    const h = n/max*250;
    const w = document.createElement('div');
    w.className = 'bar-wrap';
    w.innerHTML = `
      <div class="bar" style="height:${h}px">
        <div class="bar-val">${p}%<br>${n}次</div>
      </div>
      <div class="bar-label">洞口${i+1}</div>`;
    chart.appendChild(w);
  });
}
function renderStats() {
  const total = machines[curMachine][curSide].reduce((a,b)=>a+b,0);
  const sideTxt = {left:'左侧',center:'中间',right:'右侧'};
  document.getElementById('stats').textContent = `总次数：${total} | 当前：${sideTxt[curSide]}`;
}

/* ========== 首次启动 ========== */
loadStorage();
fillMachineList(curMachine);
setSide('center');
</script>
</body>

</html>
